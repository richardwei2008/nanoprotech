<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>NANO PROTECH</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
    <meta content="telephone=no" name="format-detection"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>


    <link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.4.min.css">
    <link rel="stylesheet" type="text/css" href="css/idangerous.swiper-2.7.0.css">
    <link rel="stylesheet" type="text/css" href="css/app-0.0.1.css">
    <link rel="stylesheet" type="text/css" href="css/showcase.css">
    <link rel="stylesheet" type="text/css" href="css/car-slide.css">


    <script src="js/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script src="js/jquery.tmpl.js" type="text/javascript"></script>
    <script src="js/jquery.mobile-1.4.4.min.js" type="text/javascript"></script>
    <script src="js/idangerous.swiper-2.7.0.min.js" type="text/javascript"></script>

    <script src="js/app.config.js"></script>
    <script src="js/app.js"></script>
    <script>
        $(window).load(function () {
            var back = function() {
                window.location.href = "index.html";
            };
            $("#home").bind("click", back);

            var getCategory = function() {
                return function() {
                    var category = $(".ui-car-icon-active").attr("id");
                    return category;
                }();
            };
            var rhLights = ["wheel-light", "lock-light", "door-light", "hood-light", "hood-light", "hood-light", "hood-light"];
            var kxLights = ["wheel-light", "lock-light"];
            var jyLights = ["hood-light", "hood-light"];

            var getLights = function() {
                return function() {
                    var category = getCategory();
                    var theLights = rhLights;
                    switch (category) {
                        case "rh":
                            theLights = rhLights;
                            break;
                        case "kx":
                            theLights = kxLights;
                            break;
                        case "jy":
                            theLights = jyLights;
                            break;
                        default: break;
                    }
                    return theLights;
                }();
            }

            var intervalId = null;
            var myFirstLightFlash = function(id, category) {
                return function() {
                    $("#" + id + "-" + category).css({opacity:0.01}, "slow").stop().animate({opacity: '1'}, "slow");
                }();
            }; // id, category

            var myCarSlideChanged = function() {
                return function() {
                    $(".ui-car-light-common").css({opacity:0.01});
                    $(".ui-car-light-common").removeClass("ui-car-icon-common-visible");
                    $(".ui-car-light-common").addClass("ui-car-icon-common-invisible");

                    var category = getCategory();
                    console.log("Category: " + category);
                    var theLights = getLights();

                    var slideLength = theLights.length;
                    console.log("Slide Length: " + slideLength);
                    var activeIndex = mySwiper.activeIndex;
                    if (activeIndex > slideLength) {
                        activeIndex = 1;
                    }
                    if (activeIndex < 1) {
                        activeIndex = slideLength;
                    }
                    console.log("Active Index: " + activeIndex);



                    var lightId = "#" + theLights[activeIndex - 1] + "-" + category;
                    console.log("Active Light ID " + lightId);
                    $(lightId).removeClass("ui-car-icon-common-invisible");
                    $(lightId).addClass("ui-car-icon-common-visible");
                    $(".ui-car-icon-common-visible").css({opacity: 1});
                    clearInterval(intervalId);
                    setTimeout(function () {
                        intervalId = setInterval(function () {
                            return function() {
                                var actives = $(".ui-car-light-common");
                                for (var i=0; i < actives.length; i++) {
                                    var active = actives[i];
                                    if ($(active).hasClass("ui-car-icon-common-visible")) {
                                        console.log("Fade Index " + i);
                                        console.log("Active ID " + active.id);
                                        $(active).css({opacity:0.01}).stop().animate({opacity: '1'}, "slow");
                                    } else {
                                        $(active).css({opacity:0.01});
                                    }
                                }
                            }();
                        }, 2000);
                    }, 0);
                }();
            };
            var mySwiper = new Swiper('.swiper-container',{
                pagination: '.pagination',
                paginationClickable: true,
                slidesPerView: 1,
                loop: true,
                category : "rh",
                // when slide
                onSlideChangeEnd : myCarSlideChanged
            });
            var renderLights = function(category) {
                return function() {
                    mySwiper.removeAllSlides();
                    $("#lights").empty();
                    $("#template-light-" + category).children(".ui-car-light-common").each(function(i) {
                        $("#lights").append($.clone(this));
                    });
                    $(".ui-car-light-common").css("background", "url('images/" + category + "_light_16.png" + "')");

                    $(mySwiper).unbind("onSlideChangeEnd").bind("onSlideChangeEnd", myCarSlideChanged);

                    setTimeout(function () {
                        intervalId = setInterval(function () {
                            var theLights = getLights();
                            myFirstLightFlash(theLights[0], category);
                        }, 2000);
                    }, 0);
                }(category);
            };
            var renderSlides = function(category) {
                return function() {
                    mySwiper.removeAllSlides();
                    $("#swiper-slides").empty();
                    $("#template-slide-" + category).children(".swiper-slide").each(function(i) {
                        mySwiper.appendSlide($.clone(this));
                    });
                    mySwiper.swipeNext();
                }(category);
            };
            renderLights("rh");
            renderSlides("rh");
            console.log("Active Index: " + mySwiper.activeIndex);
            $(".ui-car-icon-common").unbind("click").bind("click", function() {
                $(".ui-car-icon-common").removeClass("ui-car-icon-active");
                $(this).addClass("ui-car-icon-active");
                console.log(this.id);
                renderLights(this.id);
                renderSlides(this.id);
            })
        });


    </script>
</head>
<body>

<div id="page" data-role="page" class="page-car" data-theme="d">
    <div class="ui-header-custom" data-role="header">
        <a id="home" class="ui-link-back-home" data-role="none" href="#" align="right"><img src="images/back_32.png"></a>
    </div>
    <div class="ui-content-custom" data-role="content" data-theme="d">
        <div id="center" class="center ui-car-background">
            <div id="rh" class="ui-car-icon-common ui-car-icon-yellow ui-car-icon-active"></div>
            <div id="kx" class="ui-car-icon-common ui-car-icon-red"></div>
            <div id="jy" class="ui-car-icon-common ui-car-icon-blue"></div>
            <div id="lights">

            </div>
        </div>
    </div>
    <div id="footer" data-role="footer" class="footer car-footer" data-position="fixed" >
        <div class="car-bottom" align="center">
            <div class="swiper-container swiper-content">
                <div id="swiper-slides" class="swiper-wrapper">

                </div>
            </div>
            <div class="pagination"></div>
        </div>
    </div>
</div>

<div id="template-light-rh" style="display: none">
    <div id="wheel-light-rh" class="ui-car-light-common ui-car-icon-common-visible ui-car-wheel-light"></div>
    <div id="lock-light-rh" class="ui-car-light-common ui-car-icon-common-invisible ui-car-lock-light"></div>
    <div id="door-light-rh" class="ui-car-light-common ui-car-icon-common-invisible ui-car-door-light"></div>
    <div id="hood-light-rh" class="ui-car-light-common ui-car-icon-common-invisible ui-car-hood-light"></div>
</div>
<div id="template-light-kx" style="display: none">
    <div id="wheel-light-kx" class="ui-car-light-common ui-car-icon-common-visible ui-car-wheel-light"></div>
    <div id="lock-light-kx" class="ui-car-light-common ui-car-icon-common-invisible ui-car-lock-light"></div>
    <div id="door-light-kx" class="ui-car-light-common ui-car-icon-common-invisible ui-car-door-light"></div>
    <div id="hood-light-kx" class="ui-car-light-common ui-car-icon-common-invisible ui-car-hood-light"></div>
</div>
<div id="template-light-jy" style="display: none">
    <div id="wheel-light-jy" class="ui-car-light-common ui-car-icon-common-invisible  ui-car-wheel-light"></div>
    <div id="lock-light-jy" class="ui-car-light-common ui-car-icon-common-invisible ui-car-lock-light"></div>
    <div id="door-light-jy" class="ui-car-light-common ui-car-icon-common-invisible ui-car-door-light"></div>
    <div id="hood-light-jy" class="ui-car-light-common ui-car-icon-common-visible ui-car-hood-light"></div>
</div>
<div id="template-slide-rh" style="display: none">
					<div class="swiper-slide black-slide">
                        <img src="images/rh_wheel.png">
                    </div>
                    <div class="swiper-slide black-slide">
                        <img src="images/rh_lock.png">
                    </div>
                    <div class="swiper-slide black-slide">
                        <img src="images/rh_door.png">
                    </div>
                    <div class="swiper-slide black-slide">
                        <img src="images/rh_engine1.png">
                    </div>
                    <div class="swiper-slide black-slide">
                        <img src="images/rh_engine2.png">
                    </div>
                    <div class="swiper-slide black-slide">
                        <img src="images/rh_engine3.png">
                    </div>
                    <div class="swiper-slide black-slide">
                        <img src="images/rh_engine4.png">
                    </div>
			</div>
<div id="template-slide-kx" style="display: none">
					<div class="swiper-slide black-slide">
                        <img src="images/kx_wheel.png">
                    </div>
                    <div class="swiper-slide black-slide">
                        <img src="images/kx_lock.png">
                    </div>
			</div>
<div id="template-slide-jy" style="display: none">
                    <div class="swiper-slide black-slide">
                        <img src="images/jy_engine1.png">
                    </div>
                    <div class="swiper-slide black-slide">
                        <img src="images/jy_engine2.png">
                    </div>
			</div>
</body>
</html>